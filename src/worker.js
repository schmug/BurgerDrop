class t{constructor(){this.core={running:!1,score:0,lives:3,combo:1,level:1,frameCount:0,lastTime:0,highScore:this.loadHighScore()},this.entities={ingredients:[],orders:[],powerUps:[],particles:[]},this.powerUps={speedBoost:{active:!1,timeLeft:0,multiplier:.5},timeFreeze:{active:!1,timeLeft:0},scoreMultiplier:{active:!1,timeLeft:0,multiplier:2}},this.ui={colorTheme:{hue:200,saturation:50,lightness:45},screenEffects:{shake:{intensity:0,duration:0,x:0,y:0},flash:{intensity:0,color:"#ffffff"}}},this.audio={enabled:!0,settings:{master:.7,effects:.8,music:.6}},this.timing={ingredientSpeed:4,spawnRate:40,lastPowerUpSpawn:0,lastOrderSpawn:0},this.listeners=new Map,this.debug={enabled:!1,history:[],validation:!0}}updateScore(t){const e=this.core.score;this.core.score+=Math.floor(t),this.core.score>this.core.highScore&&(this.core.highScore=this.core.score,this.saveHighScore(),this.emit("newHighScore",this.core.highScore)),this.emit("scoreChanged",{old:e,new:this.core.score})}updateCombo(t){const e=this.core.combo;this.core.combo=Math.max(1,Math.min(t,10)),this.emit("comboChanged",{old:e,new:this.core.combo})}incrementCombo(){this.updateCombo(this.core.combo+1)}resetCombo(){this.updateCombo(1)}loseLife(){const t=this.core.lives;this.core.lives=Math.max(0,this.core.lives-1),this.emit("livesChanged",{old:t,new:this.core.lives}),0===this.core.lives&&this.emit("gameOver")}updateLevel(){const t=Math.floor(this.core.score/1e3)+1;if(t!==this.core.level){const e=this.core.level;this.core.level=t,this.emit("levelChanged",{old:e,new:this.core.level})}}updateFrameCount(t){this.core.frameCount++,this.core.lastTime=performance.now()}addEntity(t,e){if(!this.entities[t])throw new Error(`Unknown entity type: ${t}`);this.entities[t].push(e),this.emit("entityAdded",{type:t,entity:e}),this.enforceEntityLimits(t)}removeEntity(t,e){const i=this.entities[t].length;this.entities[t]=this.entities[t].filter(e);const s=i-this.entities[t].length;return s>0&&this.emit("entitiesRemoved",{type:t,count:s}),s}clearEntities(t){const e=this.entities[t].length;return this.entities[t]=[],e>0&&this.emit("entitiesCleared",{type:t,count:e}),e}enforceEntityLimits(t){const e={ingredients:25,particles:20,powerUps:2,orders:3}[t];if(e&&this.entities[t].length>e){const i=this.entities[t].length-e;this.entities[t].splice(0,i),this.emit("entityLimitEnforced",{type:t,removed:i})}}getEntityCount(t){return this.entities[t]?.length||0}activatePowerUp(t,e){if(!this.powerUps[t])throw new Error(`Unknown power-up type: ${t}`);this.powerUps[t].active&&this.deactivatePowerUp(t),this.powerUps[t].active=!0,this.powerUps[t].timeLeft=e,this.emit("powerUpActivated",{type:t,duration:e})}updatePowerUps(t){const e=1e3*t;Object.entries(this.powerUps).forEach((([t,i])=>{i.active&&(i.timeLeft-=e,i.timeLeft<=0&&this.deactivatePowerUp(t))}))}deactivatePowerUp(t){this.powerUps[t].active&&(this.powerUps[t].active=!1,this.powerUps[t].timeLeft=0,this.emit("powerUpDeactivated",{type:t}))}isPowerUpActive(t){return this.powerUps[t]?.active||!1}getPowerUpTimeLeft(t){return this.powerUps[t]?.timeLeft||0}startGame(){this.core.running=!0,this.core.score=0,this.core.lives=3,this.core.combo=1,this.core.level=1,this.core.frameCount=0,Object.keys(this.entities).forEach((t=>{this.clearEntities(t)})),Object.keys(this.powerUps).forEach((t=>{this.deactivatePowerUp(t)})),this.timing.lastPowerUpSpawn=0,this.timing.lastOrderSpawn=0,this.timing.ingredientSpeed=4,this.timing.spawnRate=40,this.emit("gameStarted")}endGame(){this.core.running=!1,this.core.score>this.core.highScore&&(this.core.highScore=this.core.score,this.saveHighScore()),this.emit("gameEnded",{score:this.core.score,highScore:this.core.highScore})}pauseGame(){this.core.running=!1,this.emit("gamePaused")}resumeGame(){this.core.running=!0,this.emit("gameResumed")}isRunning(){return this.core.running}loadHighScore(){try{return parseInt(localStorage.getItem("burgerDropHighScore")||"0")}catch(t){return 0}}saveHighScore(){try{localStorage.setItem("burgerDropHighScore",this.core.highScore.toString())}catch(t){}}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){const i=this.listeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}emit(t,e){this.debug.enabled&&(this.debug.history.push({timestamp:Date.now(),event:t,data:e,frameCount:this.core.frameCount}),this.debug.history.length>100&&this.debug.history.shift());const i=this.listeners.get(t);i&&i.forEach((t=>{try{t(e)}catch(t){}}))}validate(){if(!this.debug.validation)return[];const t=[];return this.core.score<0&&t.push("Score cannot be negative"),this.core.lives<0&&t.push("Lives cannot be negative"),(this.core.combo<1||this.core.combo>10)&&t.push("Combo must be between 1-10"),this.core.level<1&&t.push("Level must be positive"),Object.entries(this.entities).forEach((([e,i])=>{Array.isArray(i)||t.push(`Entity collection ${e} must be an array`)})),Object.entries(this.powerUps).forEach((([e,i])=>{i.active&&i.timeLeft<=0&&t.push(`Active power-up ${e} has invalid timeLeft`)})),t}getDebugInfo(){return{core:{...this.core},entityCounts:Object.fromEntries(Object.entries(this.entities).map((([t,e])=>[t,e.length]))),activePowerUps:Object.fromEntries(Object.entries(this.powerUps).filter((([t,e])=>e.active)).map((([t,e])=>[t,e.timeLeft]))),ui:{...this.ui},timing:{...this.timing},listenerCounts:Object.fromEntries(Array.from(this.listeners.entries()).map((([t,e])=>[t,e.length]))),errors:this.validate()}}enableDebug(){this.debug.enabled=!0,this.debug.validation=!0}disableDebug(){this.debug.enabled=!1,this.debug.validation=!1,this.debug.history=[]}getDebugHistory(){return[...this.debug.history]}}const e={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInElastic:t=>{if(0===t||1===t)return t;return-Math.pow(2,10*(t-=1))*Math.sin((t-.075)*(2*Math.PI)/.3)},easeOutElastic:t=>{if(0===t||1===t)return t;return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInBounce:t=>1-e.easeOutBounce(1-t)};class i{constructor(t=0,e=0,i="#FFFFFF",s="",n="default",a={}){this.init(t,e,i,s,n,a)}init(t=0,e=0,i="#FFFFFF",s="",n="default",a={}){return this.x=t,this.y=e,this.vx=a.vx||6*(Math.random()-.5),this.vy=a.vy||6*-Math.random()-3,this.color=i,this.text=s,this.life=1,this.decay=a.decay||.015,this.type=n,this.size=a.size||3*Math.random()+2,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.2*(Math.random()-.5),this.gravity=a.gravity||.15,this.bounce=a.bounce||.7,this.scale=1,this.startTime=0,this.duration=a.duration||60+60*Math.random(),this.canvasWidth=a.canvasWidth||800,this.canvasHeight=a.canvasHeight||600,this.pooled=!1,this}update(t,i=1/60){0===this.startTime&&(this.startTime=t);const s=t-this.startTime,n=Math.min(s/this.duration,1);if(this.x+=this.vx*i*60,this.y+=this.vy*i*60,this.vy+=this.gravity,this.rotation+=this.rotationSpeed,this.life=1-e.easeOutQuad(n),this.y>this.canvasHeight-10&&this.vy>0&&(this.vy*=-this.bounce,this.vx*=.8),"celebration"===this.type){const i=(.1*t+this.x)%(2*Math.PI);this.scale=.7+.6*e.easeInOutCubic(.5*Math.sin(i)+.5)}}draw(t){if(t.save(),t.globalAlpha=this.life,t.translate(this.x,this.y),t.rotate(this.rotation),t.scale(this.scale,this.scale),this.text)t.font=`bold ${20+2*this.size}px Arial`,t.fillStyle=this.color,t.textAlign="center",t.textBaseline="middle","celebration"===this.type&&(t.shadowColor=this.color,t.shadowBlur=10),t.fillText(this.text,0,0);else switch(t.fillStyle=this.color,this.type){case"star":this.drawStar(t);break;case"circle":t.beginPath(),t.arc(0,0,this.size,0,2*Math.PI),t.fill();break;case"triangle":t.beginPath(),t.moveTo(0,-this.size),t.lineTo(-this.size,this.size),t.lineTo(this.size,this.size),t.closePath(),t.fill();break;default:t.fillRect(-this.size/2,-this.size/2,this.size,this.size)}t.restore()}drawStar(t){const e=this.size,i=.4*this.size;t.beginPath();for(let s=0;s<5;s++){const n=s*Math.PI*2/5,a=Math.cos(n)*e,o=Math.sin(n)*e;0===s?t.moveTo(a,o):t.lineTo(a,o);const r=n+Math.PI/5,h=Math.cos(r)*i,l=Math.sin(r)*i;t.lineTo(h,l)}t.closePath(),t.fill()}isAlive(){return this.life>.01}reset(t,e,i,s="",n="default",a={}){this.x=t,this.y=e,this.vx=a.vx||6*(Math.random()-.5),this.vy=a.vy||6*-Math.random()-3,this.color=i,this.text=s,this.life=1,this.decay=a.decay||.015,this.type=n,this.size=a.size||3*Math.random()+2,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.2*(Math.random()-.5),this.gravity=a.gravity||.15,this.bounce=a.bounce||.7,this.scale=1,this.startTime=0,this.duration=a.duration||60+60*Math.random(),a.canvasWidth&&(this.canvasWidth=a.canvasWidth),a.canvasHeight&&(this.canvasHeight=a.canvasHeight)}getBounds(){const t=this.size*this.scale;return{x:this.x-t,y:this.y-t,width:2*t,height:2*t}}updateCanvasDimensions(t,e){this.canvasWidth=t,this.canvasHeight=e}static createCelebration(t,e,s,n="‚ú®"){return new i(t,e,s,n,"celebration",{vx:8*(Math.random()-.5),vy:8*-Math.random()-5,size:4*Math.random()+3,duration:90+60*Math.random(),gravity:.1,bounce:.9})}static createExplosion(t,e,s,n=10,a="star"){const o=[];for(let r=0;r<n;r++){const h=r/n*Math.PI*2,l=6*Math.random()+3,c=Math.cos(h)*l,d=Math.sin(h)*l-2;o.push(new i(t,e,s,"",a,{vx:c,vy:d,size:3*Math.random()+1,duration:45+30*Math.random(),gravity:.2}))}return o}static resetParticle(t,e,i,s,n="",a="default",o={}){t.init(e,i,s,n,a,o)}static createFactory(){return()=>new i}static createFloatingText(t,e,s,n="#FFD700"){return new i(t,e,n,s,"text",{vx:2*(Math.random()-.5),vy:-2-2*Math.random(),size:0,duration:120,gravity:0,bounce:0})}}const s={speedBoost:{emoji:"üêå",name:"Slow Motion",color:"#FFD700",duration:8e3,description:"Slows ingredient fall speed"},timeFreeze:{emoji:"‚ùÑÔ∏è",name:"Time Freeze",color:"#87CEEB",duration:5e3,description:"Freezes order timers"},scoreMultiplier:{emoji:"üíé",name:"Score Boost",color:"#FF69B4",duration:1e4,description:"Double score points"}};class n{constructor(t,e={}){if(this.type=t,this.data=s[t],!this.data)throw new Error(`Unknown power-up type: ${t}`);this.x=void 0!==e.x?e.x:Math.random()*(e.canvasWidth||750),this.y=void 0!==e.y?e.y:-50,this.speed=e.speed||1.5,this.collected=!1,this.size=e.size||40,this.cachedFont=null,this.canvasWidth=e.canvasWidth||800,this.canvasHeight=e.canvasHeight||600,this.animationTime=0,this.pulseIntensity=e.pulseIntensity||.1}update(t=1/60){this.y+=this.speed*t*60,this.animationTime+=t}draw(t){const e=this.x+this.size/2,i=this.y+this.size/2,s=1+Math.sin(4*this.animationTime)*this.pulseIntensity,n=this.size*s;t.save(),t.shadowColor=this.data.color,t.shadowBlur=10,t.fillStyle=this.data.color,t.beginPath(),t.arc(e,i,n/2,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke(),this.cachedFont||(this.cachedFont=.6*this.size+"px Arial"),t.font=this.cachedFont,t.textAlign="center",t.textBaseline="middle",t.fillStyle="#FFFFFF",t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=2,t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillText(this.data.emoji,e,i),t.restore()}isClicked(t,e){const i=this.x+this.size/2,s=this.y+this.size/2;return Math.sqrt((t-i)**2+(e-s)**2)<=this.size/2}isOffScreen(){return this.y>this.canvasHeight+this.size}getBounds(){return{x:this.x,y:this.y,width:this.size,height:this.size}}getCenter(){return{x:this.x+this.size/2,y:this.y+this.size/2}}collect(){this.collected=!0}isCollected(){return this.collected}getDuration(){return this.data.duration}getDescription(){return this.data.description}updateCanvasDimensions(t,e){this.canvasWidth=t,this.canvasHeight=e}static createRandom(t={}){const e=Object.keys(s),i=e[Math.floor(Math.random()*e.length)];return new n(i,t)}static getAvailableTypes(){return Object.keys(s)}static getTypeConfig(t){return s[t]||null}static isValidType(t){return t in s}}const a={bun_top:{emoji:"üçû",variants:["üçû","ü•ñ"],name:"Top Bun",size:40,color:"#D2B48C"},bun_bottom:{emoji:"ü•ñ",variants:["ü•ñ","üçû"],name:"Bottom Bun",size:40,color:"#DEB887"},patty:{emoji:"ü•©",variants:["ü•©","üçñ"],name:"Patty",size:45,color:"#8B4513"},cheese:{emoji:"üßÄ",variants:["üßÄ","üü®"],name:"Cheese",size:35,color:"#FFD700"},lettuce:{emoji:"ü•¨",variants:["ü•¨","üçÉ"],name:"Lettuce",size:35,color:"#90EE90"},tomato:{emoji:"üçÖ",variants:["üçÖ","üî¥"],name:"Tomato",size:35,color:"#FF6347"},pickle:{emoji:"ü•í",variants:["ü•í","üü¢"],name:"Pickle",size:30,color:"#9ACD32"},bacon:{emoji:"ü•ì",variants:["ü•ì","üî•"],name:"Bacon",size:35,color:"#DC143C"},onion:{emoji:"üßÖ",variants:["üßÖ","‚ö™"],name:"Onion",size:30,color:"#F5F5DC"},egg:{emoji:"üç≥",variants:["üç≥","üü°"],name:"Egg",size:40,color:"#FFFFE0"}};class o{constructor(t="bun_top",e={}){this.init(t,e)}init(t,e={}){if(this.type=t,this.data=a[t],!this.data)throw new Error(`Unknown ingredient type: ${t}`);this.x=void 0!==e.x?e.x:Math.random()*(e.canvasWidth||800-this.data.size),this.y=void 0!==e.y?e.y:-this.data.size;const i=e.baseSpeed||4,s=4*Math.random()-2,n=Math.random()<.1?Math.random()<.5?.4:2.2:1;this.speed=(i+s)*n,this.baseSpeed=this.speed,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.1*(Math.random()-.5),this.collected=!1,this.startY=this.y,this.fallProgress=0,this.sway=2*Math.random()-1,this.trail=[],this.maxTrailLength=e.maxTrailLength||8,this.trailUpdateInterval=e.trailUpdateInterval||3,this.trailCounter=0,this.animationTime=0,this.canvasWidth=e.canvasWidth||800,this.canvasHeight=e.canvasHeight||600}update(t,i,s=1/60){this.animationTime+=s;let n=1;i&&i.isPowerUpActive&&i.isPowerUpActive("speedBoost")&&(n=i.powerUps.speedBoost.multiplier),this.speed=this.baseSpeed*n,this.fallProgress+=.02;const a=e.easeInQuad(Math.min(this.fallProgress,1));this.y+=this.speed*(.5+.5*a)*s*60;const o=.5*Math.sin(.05*t+this.sway*Math.PI);this.x+=o*s*60,this.rotation+=this.rotationSpeed*(1+.5*a),this.trailCounter++,this.trailCounter>=this.trailUpdateInterval&&(this.trail.push({x:this.x+this.data.size/2,y:this.y+this.data.size/2,alpha:1,size:.8*this.data.size}),this.trail.length>this.maxTrailLength&&this.trail.shift(),this.trailCounter=0),this.trail.forEach(((t,i)=>{const s=(i+1)/this.trail.length;t.alpha=.6*e.easeOutCubic(s),t.size*=.98}))}draw(t,e,i){this.drawTrail(t,i),t.save(),t.translate(this.x+this.data.size/2,this.y+this.data.size/2),t.rotate(this.rotation),t.shadowColor="rgba(0, 0, 0, 0.4)",t.shadowBlur=6,t.shadowOffsetX=3,t.shadowOffsetY=3;const s=e%120<10&&this.data.variants?this.data.variants[Math.floor(e/30)%this.data.variants.length]:this.data.emoji;t.font=`${this.data.size}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(s,0,0),t.restore()}drawTrail(t,e){if(!(this.trail.length<2)){t.save();for(let e=0;e<this.trail.length-1;e++){const i=this.trail[e],s=this.trail[e+1],n=t.createLinearGradient(i.x,i.y,s.x,s.y);n.addColorStop(0,`rgba(255, 255, 255, ${.3*i.alpha})`),n.addColorStop(1,`rgba(255, 255, 255, ${.3*s.alpha})`),t.strokeStyle=n,t.lineWidth=Math.max(.15*i.size,1),t.lineCap="round",t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.stroke()}this.trail.forEach((i=>{t.globalAlpha=.4*i.alpha;const s=e?.accent||"#00FF88";t.fillStyle=s+"80",t.beginPath(),t.arc(i.x,i.y,Math.max(.1*i.size,2),0,2*Math.PI),t.fill()})),t.restore()}}isClicked(t,e){return t>=this.x&&t<=this.x+this.data.size&&e>=this.y&&e<=this.y+this.data.size}isOffScreen(){return this.y>this.canvasHeight+this.data.size}getBounds(){return{x:this.x,y:this.y,width:this.data.size,height:this.data.size}}getCenter(){return{x:this.x+this.data.size/2,y:this.y+this.data.size/2}}collect(){this.collected=!0}isCollected(){return this.collected}getName(){return this.data.name}getColor(){return this.data.color}updateCanvasDimensions(t,e){this.canvasWidth=t,this.canvasHeight=e}reset(t,e={}){if(this.type=t,this.data=a[t],!this.data)throw new Error(`Unknown ingredient type: ${t}`);this.x=void 0!==e.x?e.x:Math.random()*((e.canvasWidth||this.canvasWidth||800)-this.data.size),this.y=void 0!==e.y?e.y:-this.data.size;const i=e.baseSpeed||4,s=4*Math.random()-2,n=Math.random()<.1?Math.random()<.5?.4:2.2:1;this.speed=(i+s)*n,this.baseSpeed=this.speed,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.1*(Math.random()-.5),this.collected=!1,this.startY=this.y,this.fallProgress=0,this.sway=2*Math.random()-1,this.trail=[],this.maxTrailLength=e.maxTrailLength||8,this.trailUpdateInterval=e.trailUpdateInterval||3,this.trailCounter=0,this.animationTime=0,e.canvasWidth&&(this.canvasWidth=e.canvasWidth),e.canvasHeight&&(this.canvasHeight=e.canvasHeight)}static createRandom(t={}){const e=Object.keys(a),i=e[Math.floor(Math.random()*e.length)];return new o(i,t)}static getAvailableTypes(){return Object.keys(a)}static getTypeConfig(t){return a[t]||null}static isValidType(t){return t in a}}const r=[{name:"Classic Burger",ingredients:["bun_bottom","patty","cheese","lettuce","tomato","bun_top"],time:30},{name:"Simple Burger",ingredients:["bun_bottom","patty","bun_top"],time:20},{name:"Cheese Burger",ingredients:["bun_bottom","patty","cheese","bun_top"],time:25},{name:"Veggie Burger",ingredients:["bun_bottom","lettuce","tomato","onion","pickle","bun_top"],time:30},{name:"Bacon Burger",ingredients:["bun_bottom","patty","bacon","cheese","bun_top"],time:35},{name:"Breakfast Burger",ingredients:["bun_bottom","patty","egg","bacon","cheese","bun_top"],time:40}];class h{constructor(t,e={}){if(!t)throw new Error("Order template is required");this.template=t,this.ingredients=[...t.ingredients],this.currentIndex=0,this.timeLeft=1e3*t.time,this.x=0,this.y=0,this.width=e.width||120,this.height=e.height||180,this.completed=!1,this.expired=!1,this.animationTime=0,this.pulsePhase=Math.random()*Math.PI*2,this.enableTextures=!1!==e.enableTextures,this.enableShadows=!1!==e.enableShadows,this.enablePulse=!1!==e.enablePulse}update(t,e){this.animationTime+=t;let i=!0;return e&&e.isPowerUpActive&&e.isPowerUpActive("timeFreeze")&&(i=!1),i&&!this.completed&&(this.timeLeft-=1e3*t),!(this.timeLeft<=0&&!this.completed)||(this.expired=!0,!1)}draw(t,e,i,s={}){const n=s.margin||10;this.x=n+e*(this.width+n),this.y=s.startY||80;const a=this.timeLeft<1e4;t.save(),this.enableTextures&&s.textures?.paper&&(t.fillStyle=s.textures.paper,t.fillRect(this.x,this.y,this.width,this.height));const o=t.createLinearGradient(this.x,this.y,this.x,this.y+this.height);a?(o.addColorStop(0,"rgba(255, 120, 120, 0.85)"),o.addColorStop(1,"rgba(255, 80, 80, 0.8)")):(o.addColorStop(0,"rgba(255, 255, 255, 0.85)"),o.addColorStop(1,"rgba(245, 245, 245, 0.8)")),this.enableShadows&&(t.shadowColor="rgba(0, 0, 0, 0.3)",t.shadowBlur=10,t.shadowOffsetX=3,t.shadowOffsetY=4),t.fillStyle=o,t.fillRect(this.x,this.y,this.width,this.height),this.enableShadows&&(t.shadowColor="transparent"),t.strokeStyle=a?"#CC3333":"#333",t.lineWidth=2,t.strokeRect(this.x,this.y,this.width,this.height),t.restore(),t.fillStyle="#333",t.font="600 12px Nunito, Arial",t.textAlign="center",t.fillText(this.template.name,this.x+this.width/2,this.y+15);const r=Math.ceil(this.timeLeft/1e3);t.fillStyle=this.timeLeft<1e4?"#FF0000":"#333",t.font="700 14px Nunito, Arial",t.fillText(`${r}s`,this.x+this.width/2,this.y+30),this.drawIngredients(t,i)}drawIngredients(t,e){const i=this.y+this.height-25;for(let s=0;s<this.ingredients.length;s++){const n=a[this.ingredients[s]];if(!n)continue;const o=i-20*s;t.save(),s<this.currentIndex?t.globalAlpha=.3:s===this.currentIndex&&this.drawCurrentIngredientHighlight(t,o,e),s===this.currentIndex?this.drawCurrentIngredient(t,n,o):this.drawIngredient(t,n,o),t.restore()}}drawCurrentIngredientHighlight(t,e,i){const s=t.createLinearGradient(this.x+5,e-15,this.x+this.width-5,e+10);if(s.addColorStop(0,"rgba(255, 255, 255, 0.8)"),s.addColorStop(.5,"rgba(255, 215, 0, 0.9)"),s.addColorStop(1,"rgba(255, 165, 0, 0.7)"),t.fillStyle=s,t.fillRect(this.x+3,e-17,this.width-6,29),t.strokeStyle="#FF8C00",t.lineWidth=2,t.strokeRect(this.x+3,e-17,this.width-6,29),this.enablePulse){const s=.3+.2*Math.sin(.15*i+this.pulsePhase);t.fillStyle=`rgba(255, 215, 0, ${s})`,t.fillRect(this.x+1,e-19,this.width-2,33)}}drawCurrentIngredient(t,e,i){t.font="20px Arial",t.textAlign="center",t.shadowColor="#FF4500",t.shadowBlur=12,t.shadowOffsetX=0,t.shadowOffsetY=0,t.strokeStyle="#FFFFFF",t.lineWidth=3,t.strokeText(e.emoji,this.x+this.width/2,i),t.save(),t.translate(this.x+this.width/2,i),t.scale(1.2,1.2),t.fillText(e.emoji,0,0),t.restore(),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}drawIngredient(t,e,i){t.font="20px Arial",t.textAlign="center",t.fillText(e.emoji,this.x+this.width/2,i)}checkIngredient(t){return this.completed||this.expired?"wrong":this.currentIndex<this.ingredients.length&&this.ingredients[this.currentIndex]===t?(this.currentIndex++,this.currentIndex>=this.ingredients.length?(this.completed=!0,"completed"):"correct"):"wrong"}getCurrentIngredient(){return this.currentIndex>=this.ingredients.length?null:this.ingredients[this.currentIndex]}getProgress(){return this.currentIndex/this.ingredients.length}getTimeRemaining(){return Math.max(0,this.timeLeft/1e3)}isCompleted(){return this.completed}isExpired(){return this.expired}isExpiringSoon(){return this.timeLeft<1e4}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}reset(){this.currentIndex=0,this.timeLeft=1e3*this.template.time,this.completed=!1,this.expired=!1,this.animationTime=0}static createRandom(t={}){const e=r[Math.floor(Math.random()*r.length)];return new h(e,t)}static getAvailableTemplates(){return[...r]}static getTemplateByName(t){return r.find((e=>e.name===t))||null}static isValidTemplate(t){return!!(t&&"string"==typeof t.name&&Array.isArray(t.ingredients)&&t.ingredients.length>0&&"number"==typeof t.time&&t.time>0)}}const l={ingredientCorrect:{frequency:880,type:"sine",duration:.15,volume:.6},ingredientWrong:{frequency:220,type:"sawtooth",duration:.2,volume:.5},orderComplete:{frequencies:[523,659,784,1047],type:"sine",duration:.2,volume:.8},orderExpired:{frequency:165,type:"square",duration:.3,volume:.7},powerUpCollect:{frequency:698,type:"triangle",duration:.25,volume:.7},doublePointsActivate:{frequency:1397,type:"sine",duration:.3,volume:.8,duck:!0},slowTimeActivate:{frequency:440,type:"triangle",duration:.4,volume:.8,duck:!0},comboMultiplierActivate:{frequency:587,type:"square",duration:.35,volume:.7,duck:!0},comboIncrease:{frequency:659,type:"sine",duration:.1,volume:.5},buttonClick:{frequency:1e3,type:"sine",duration:.05,volume:.3},gameOver:{frequencies:[330,311,294,277],type:"sawtooth",duration:.4,volume:.8}},c={melody:[523,587,659,784,880]};class d{constructor(t={}){this.audioContext=null,this.audioProcessingChain=null,this.enabled=!0,this.settings={master:t.master||.3,effects:t.effects||1,music:t.music||.5,preset:t.preset||"normal"},this.backgroundMusic={playing:!1,oscillators:[],gainNodes:[],melodyInterval:null,cleanupInterval:null},this.musicGainNode=null,this.isDucking=!1,this.eventListeners=new Map,this.init()}init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.setupAudioProcessingChain(),this.setupUserInteractionHandlers()}catch(t){this.enabled=!1}}setupAudioProcessingChain(){if(!this.audioContext)return;const t=this.audioContext.createDynamicsCompressor();t.threshold.setValueAtTime(-20,this.audioContext.currentTime),t.knee.setValueAtTime(10,this.audioContext.currentTime),t.ratio.setValueAtTime(6,this.audioContext.currentTime),t.attack.setValueAtTime(.003,this.audioContext.currentTime),t.release.setValueAtTime(.1,this.audioContext.currentTime);const e=this.audioContext.createDynamicsCompressor();e.threshold.setValueAtTime(-6,this.audioContext.currentTime),e.knee.setValueAtTime(0,this.audioContext.currentTime),e.ratio.setValueAtTime(20,this.audioContext.currentTime),e.attack.setValueAtTime(.001,this.audioContext.currentTime),e.release.setValueAtTime(.01,this.audioContext.currentTime),t.connect(e),e.connect(this.audioContext.destination),this.audioProcessingChain=t}setupUserInteractionHandlers(){const t=()=>{this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume()};document.addEventListener("click",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0})}createOscillator(t,e="sine",i=.1,s=1){if(!this.audioContext||!this.enabled)return null;const n=this.audioContext.createOscillator(),a=this.audioContext.createGain(),o=this.audioContext.createBiquadFilter();o.type="lowpass",o.frequency.setValueAtTime(8e3,this.audioContext.currentTime),o.Q.setValueAtTime(.7,this.audioContext.currentTime),n.connect(a),a.connect(o),this.audioProcessingChain?o.connect(this.audioProcessingChain):o.connect(this.audioContext.destination),n.type=e,n.frequency.setValueAtTime(t,this.audioContext.currentTime);const r=this.settings.master*this.settings.effects*s;return a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(r,this.audioContext.currentTime+.01),a.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+i),{oscillator:n,gainNode:a,filter:o}}playSound(t){if(!this.audioContext||!this.enabled||0===this.settings.effects)return;const{frequency:e,type:i="sine",duration:s=.1,volume:n=1,duck:a=!1}=t,o=this.createOscillator(e,i,s,n);if(o){const{oscillator:t}=o;t.start(),t.stop(this.audioContext.currentTime+s),t.addEventListener("ended",(()=>{t.disconnect()})),a&&(this.duckBackgroundMusic(),setTimeout((()=>this.restoreBackgroundMusic()),1e3*s))}}playSequence(t,e="sine",i=.1,s=1){this.audioContext&&this.enabled&&0!==this.settings.effects&&t.forEach(((t,n)=>{setTimeout((()=>{this.playSound({frequency:t,type:e,duration:.8*i,volume:s})}),n*i*1e3*.9)}))}playIngredientCorrect(){this.playSound(l.ingredientCorrect)}playIngredientWrong(){this.playSound(l.ingredientWrong)}playOrderComplete(){this.playSequence(l.orderComplete.frequencies,l.orderComplete.type,l.orderComplete.duration,l.orderComplete.volume)}playOrderExpired(){this.playSound(l.orderExpired)}playPowerUpCollect(){this.playSound(l.powerUpCollect)}playPowerUpActivate(t){const e=l[t+"Activate"];e&&(this.duckBackgroundMusic(),this.playSound(e),setTimeout((()=>this.restoreBackgroundMusic()),300))}playComboIncrease(){this.playSound(l.comboIncrease)}playButtonClick(){this.playSound(l.buttonClick)}playGameOver(){this.audioContext&&this.enabled&&0!==this.settings.effects&&l.gameOver.frequencies.forEach(((t,e)=>{setTimeout((()=>{this.playSound({frequency:t,type:l.gameOver.type,duration:.7*l.gameOver.duration,volume:l.gameOver.volume})}),150*e)}))}playCollect(){this.playIngredientCorrect()}playError(){this.playIngredientWrong()}playNewOrder(){this.playButtonClick()}startBackgroundMusic(){this.audioContext&&this.enabled&&!this.backgroundMusic.playing&&0!==this.settings.music&&(this.musicGainNode||(this.musicGainNode=this.audioContext.createGain(),this.audioProcessingChain?this.musicGainNode.connect(this.audioProcessingChain):this.musicGainNode.connect(this.audioContext.destination),this.musicGainNode.gain.setValueAtTime(this.settings.master*this.settings.music,this.audioContext.currentTime)),this.backgroundMusic.playing=!0,this.backgroundMusic.melodyInterval=setInterval((()=>{this.backgroundMusic.playing&&this.settings.music>0?this.playMelodyNote():clearInterval(this.backgroundMusic.melodyInterval)}),3e3+2e3*Math.random()),this.backgroundMusic.cleanupInterval=setInterval((()=>{this.cleanupOscillators()}),5e3))}stopBackgroundMusic(){this.backgroundMusic.playing=!1,this.backgroundMusic.melodyInterval&&(clearInterval(this.backgroundMusic.melodyInterval),this.backgroundMusic.melodyInterval=null),this.backgroundMusic.cleanupInterval&&(clearInterval(this.backgroundMusic.cleanupInterval),this.backgroundMusic.cleanupInterval=null),this.backgroundMusic.oscillators.forEach((t=>{try{t.stop(),t.disconnect()}catch(t){}})),this.backgroundMusic.oscillators=[],this.backgroundMusic.gainNodes=[]}playMelodyNote(){if(!this.backgroundMusic.playing||!this.musicGainNode||0===this.settings.music)return;const t=Math.floor(Math.random()*c.melody.length),e=c.melody[t],i=this.settings.master*this.settings.music*.1,s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.musicGainNode),s.type="sine",s.frequency.setValueAtTime(e,this.audioContext.currentTime),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.1),n.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+1.5),s.start(),s.stop(this.audioContext.currentTime+2),s.addEventListener("ended",(()=>{const t=this.backgroundMusic.oscillators.indexOf(s),e=this.backgroundMusic.gainNodes.indexOf(n);t>-1&&this.backgroundMusic.oscillators.splice(t,1),e>-1&&this.backgroundMusic.gainNodes.splice(e,1)})),this.backgroundMusic.oscillators.push(s),this.backgroundMusic.gainNodes.push(n)}cleanupOscillators(){this.backgroundMusic.oscillators=this.backgroundMusic.oscillators.filter((t=>{try{return"closed"!==t.context.state}catch(t){return!1}})),this.backgroundMusic.gainNodes=this.backgroundMusic.gainNodes.filter((t=>{try{return"closed"!==t.context.state}catch(t){return!1}}))}duckBackgroundMusic(){if(!this.musicGainNode||this.isDucking)return;this.isDucking=!0;const t=this.settings.master*this.settings.music,e=.3*t;this.musicGainNode.gain.cancelScheduledValues(this.audioContext.currentTime),this.musicGainNode.gain.setValueAtTime(t,this.audioContext.currentTime),this.musicGainNode.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+.1)}restoreBackgroundMusic(){if(!this.musicGainNode||!this.isDucking)return;this.isDucking=!1;const t=this.settings.master*this.settings.music;this.musicGainNode.gain.cancelScheduledValues(this.audioContext.currentTime),this.musicGainNode.gain.linearRampToValueAtTime(t,this.audioContext.currentTime+.3)}setMasterVolume(t){if(this.settings.master=Math.max(0,Math.min(1,t)),this.musicGainNode&&!this.isDucking){const t=this.settings.master*this.settings.music;this.musicGainNode.gain.setValueAtTime(t,this.audioContext.currentTime)}this.emit("volumeChanged",{type:"master",value:this.settings.master})}setEffectsVolume(t){this.settings.effects=Math.max(0,Math.min(1,t)),this.emit("volumeChanged",{type:"effects",value:this.settings.effects})}setMusicVolume(t){if(this.settings.music=Math.max(0,Math.min(1,t)),this.musicGainNode&&!this.isDucking){const t=this.settings.master*this.settings.music;this.musicGainNode.gain.setValueAtTime(t,this.audioContext.currentTime)}t>0&&!this.backgroundMusic.playing?this.startBackgroundMusic():0===t&&this.stopBackgroundMusic(),this.emit("volumeChanged",{type:"music",value:this.settings.music})}setPreset(t){const e={quiet:{master:.15,effects:.8,music:.3},normal:{master:.3,effects:1,music:.5},energetic:{master:.5,effects:1,music:.7}}[t];e&&(this.setMasterVolume(e.master),this.setEffectsVolume(e.effects),this.setMusicVolume(e.music),this.settings.preset=t,this.emit("presetChanged",t))}setEnabled(t){this.enabled=t,t||this.stopBackgroundMusic(),this.emit("enabledChanged",t)}getSettings(){return{...this.settings}}isEnabled(){return this.enabled&&!!this.audioContext}destroy(){this.stopBackgroundMusic(),this.musicGainNode&&(this.musicGainNode.disconnect(),this.musicGainNode=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.eventListeners.clear()}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}emit(t,e){const i=this.eventListeners.get(t);i&&i.forEach((t=>{try{t(e)}catch(t){}}))}}function u(t,e,i=50){const s=document.createElement("canvas");s.width=i,s.height=i;const n=s.getContext("2d");switch(e){case"wood":const t=n.createLinearGradient(0,0,0,i);t.addColorStop(0,"#DEB887"),t.addColorStop(.3,"#D2B48C"),t.addColorStop(.7,"#CD853F"),t.addColorStop(1,"#A0522D"),n.fillStyle=t,n.fillRect(0,0,i,i),n.strokeStyle="rgba(139, 69, 19, 0.3)",n.lineWidth=1;for(let t=0;t<8;t++){const e=t*i/8+3*Math.sin(t);n.beginPath(),n.moveTo(0,e),n.lineTo(i,e+2*Math.sin(.5*t)),n.stroke()}break;case"marble":const e=n.createRadialGradient(i/2,i/2,0,i/2,i/2,i/2);e.addColorStop(0,"#F8F8FF"),e.addColorStop(.5,"#E6E6FA"),e.addColorStop(1,"#D3D3D3"),n.fillStyle=e,n.fillRect(0,0,i,i),n.strokeStyle="rgba(169, 169, 169, 0.4)",n.lineWidth=2,n.beginPath(),n.moveTo(0,.3*i),n.quadraticCurveTo(.7*i,.1*i,i,.8*i),n.stroke();break;case"fabric":n.fillStyle="#F5F5DC",n.fillRect(0,0,i,i),n.fillStyle="rgba(210, 180, 140, 0.5)";const s=i/10;for(let t=0;t<i;t+=s)for(let e=0;e<i;e+=s)(Math.floor(t/s)+Math.floor(e/s))%2&&n.fillRect(t,e,s,s);break;case"paper":n.fillStyle="#FFFEF0",n.fillRect(0,0,i,i);for(let t=0;t<20;t++)n.strokeStyle=`rgba(220, 220, 200, ${.3*Math.random()})`,n.lineWidth=.5,n.beginPath(),n.moveTo(Math.random()*i,Math.random()*i),n.lineTo(Math.random()*i,Math.random()*i),n.stroke();break;default:n.fillStyle="#FFFFFF",n.fillRect(0,0,i,i)}return t.createPattern(s,"repeat")}function p(){const t=["#FF6B6B","#4ECDC4","#45B7D1","#F7DC6F","#BB8FCE","#85C872","#F8B500","#FF6F91","#6C5CE7","#00D2D3"];return t[Math.floor(Math.random()*t.length)]}class m{constructor(t,e={}){this.canvas=t,this.ctx=t.getContext("2d"),this.enableTextures=!1!==e.enableTextures,this.enableShadows=!1!==e.enableShadows,this.enableEffects=!1!==e.enableEffects,this.patterns={wood:null,marble:null,fabric:null,paper:null},this.screenEffects={shake:{intensity:0,duration:0,x:0,y:0},flash:{intensity:0,color:"#FFFFFF",duration:0},ripple:{active:!1,x:0,y:0,radius:0,maxRadius:0},glitch:{active:!1,intensity:0,duration:0}},this.stats={drawCalls:0,frameTime:0,lastFrameTime:0},this.init()}init(){this.setupCanvas(),this.enableTextures&&this.initializePatterns(),this.setupEventListeners()}setupCanvas(){this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.resizeCanvas()}resizeCanvas(){const t=this.canvas.width,e=this.canvas.height;return this.canvas.width=Math.min(window.innerWidth,480),this.canvas.height=window.innerHeight,this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",{changed:t!==this.canvas.width||e!==this.canvas.height,width:this.canvas.width,height:this.canvas.height}}setupEventListeners(){window.addEventListener("resize",(()=>this.resizeCanvas()))}initializePatterns(){this.patterns.wood=u(this.ctx,"wood",60),this.patterns.marble=u(this.ctx,"marble",80),this.patterns.fabric=u(this.ctx,"fabric",40),this.patterns.paper=u(this.ctx,"paper",100)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.stats.drawCalls=0}beginFrame(t){this.stats.frameTime=t-this.stats.lastFrameTime,this.stats.lastFrameTime=t,this.clear()}endFrame(){this.drawScreenEffects()}drawBackground(){this.ctx.save(),this.enableTextures&&this.patterns.fabric&&(this.ctx.fillStyle=this.patterns.fabric,this.ctx.globalAlpha=.05,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height-100),this.ctx.globalAlpha=1),this.enableTextures&&this.patterns.wood&&(this.ctx.fillStyle=this.patterns.wood,this.ctx.globalAlpha=.6,this.ctx.fillRect(0,this.canvas.height-100,this.canvas.width,100),this.ctx.globalAlpha=1);const t=this.ctx.createLinearGradient(0,this.canvas.height-100,0,this.canvas.height);t.addColorStop(0,"rgba(139, 69, 19, 0.3)"),t.addColorStop(.5,"rgba(101, 67, 33, 0.4)"),t.addColorStop(1,"rgba(83, 53, 27, 0.5)"),this.ctx.fillStyle=t,this.ctx.fillRect(0,this.canvas.height-100,this.canvas.width,100),this.ctx.restore(),this.stats.drawCalls++}drawButton(t,e,i,s,n,a=!1){this.ctx.save();const o=a?2:4;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+o,e+o,i,s);const r=this.ctx.createLinearGradient(t,e,t,e+s);a?(r.addColorStop(0,"#E6B800"),r.addColorStop(1,"#FFD700")):(r.addColorStop(0,"#FFD700"),r.addColorStop(.5,"#FFA500"),r.addColorStop(1,"#FF8C00")),this.ctx.fillStyle=r,this.ctx.fillRect(t,e,i,s),this.ctx.strokeStyle="#B8860B",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,i,s),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=1,this.ctx.strokeRect(t+1,e+1,i-2,s-2),this.ctx.fillStyle="#333",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(n,t+i/2,e+s/2+(a?1:0)),this.ctx.restore(),this.stats.drawCalls++}drawHeart(t,e,i,s="#FF0000",n=!1,a=0){if(this.ctx.save(),this.ctx.translate(t,e),n){const t=1+.1*Math.sin(.3*a);this.ctx.scale(t,t)}this.ctx.fillStyle=s,this.ctx.beginPath();const o=.5*i;this.ctx.moveTo(0,.3*o),this.ctx.bezierCurveTo(-o,.3*-o,-o,.3*o,0,o),this.ctx.bezierCurveTo(o,.3*o,o,.3*-o,0,.3*o),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.ellipse(.3*-o,.1*-o,.2*o,.15*o,0,0,2*Math.PI),this.ctx.fill(),this.ctx.restore(),this.stats.drawCalls++}drawStar(t,e,i,s="#FFD700",n=!1,a=0){if(this.ctx.save(),this.ctx.translate(t,e),n){const t=.05*a;this.ctx.rotate(t);const e=.8+.3*Math.sin(.2*a);this.ctx.scale(e,e)}this.ctx.fillStyle=s;const o=i,r=.4*i;this.ctx.beginPath();for(let t=0;t<5;t++){const e=t*Math.PI*2/5-Math.PI/2,i=Math.cos(e)*o,s=Math.sin(e)*o;0===t?this.ctx.moveTo(i,s):this.ctx.lineTo(i,s);const n=e+Math.PI/5,a=Math.cos(n)*r,h=Math.sin(n)*r;this.ctx.lineTo(a,h)}this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.beginPath(),this.ctx.arc(0,.2*-i,.15*i,0,2*Math.PI),this.ctx.fill(),this.ctx.restore(),this.stats.drawCalls++}drawBurger(t,e,i){this.ctx.save(),this.ctx.translate(t,e);let s=.4*i;[{color:"#D2B48C",height:.15*i,type:"bun"},{color:"#90EE90",height:.08*i,type:"lettuce"},{color:"#FF6347",height:.08*i,type:"tomato"},{color:"#FFD700",height:.06*i,type:"cheese"},{color:"#8B4513",height:.2*i,type:"patty"},{color:"#DEB887",height:.15*i,type:"bun"}].forEach((t=>{this.ctx.fillStyle=t.color,"bun"===t.type?(this.ctx.beginPath(),this.ctx.ellipse(0,s,.4*i,t.height,0,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.beginPath(),this.ctx.ellipse(0,s-.3*t.height,.3*i,.5*t.height,0,0,2*Math.PI),this.ctx.fill()):(this.ctx.beginPath(),this.ctx.ellipse(0,s,.35*i,t.height,0,0,2*Math.PI),this.ctx.fill()),s-=1.5*t.height})),this.ctx.restore(),this.stats.drawCalls++}drawText(t,e,i,s={}){const{font:n="16px Arial",color:a="#000000",align:o="left",baseline:r="top",shadow:h=!1,shadowColor:l="rgba(0, 0, 0, 0.5)",shadowBlur:c=2,shadowOffset:d={x:1,y:1},stroke:u=!1,strokeColor:p="#FFFFFF",strokeWidth:m=2}=s;this.ctx.save(),this.ctx.font=n,this.ctx.textAlign=o,this.ctx.textBaseline=r,h&&(this.ctx.shadowColor=l,this.ctx.shadowBlur=c,this.ctx.shadowOffsetX=d.x,this.ctx.shadowOffsetY=d.y),u&&(this.ctx.strokeStyle=p,this.ctx.lineWidth=m,this.ctx.strokeText(t,e,i)),this.ctx.fillStyle=a,this.ctx.fillText(t,e,i),this.ctx.restore(),this.stats.drawCalls++}startScreenShake(t,e){this.screenEffects.shake.intensity=t,this.screenEffects.shake.duration=e}updateScreenShake(){const t=this.screenEffects.shake;t.duration>0?(t.duration--,t.x=(Math.random()-.5)*t.intensity,t.y=(Math.random()-.5)*t.intensity,this.canvas.style.transform=`translate(${t.x}px, ${t.y}px)`,t.intensity*=.9):(t.intensity=0,t.x=0,t.y=0,this.canvas.style.transform="translate(0px, 0px)")}startScreenFlash(t,e,i){this.screenEffects.flash.color=t,this.screenEffects.flash.intensity=e,this.screenEffects.flash.duration=i}updateScreenFlash(){const t=this.screenEffects.flash;t.duration>0?(t.duration--,t.intensity*=.85):t.intensity=0}drawScreenFlash(){const t=this.screenEffects.flash;t.intensity>.01&&(this.ctx.save(),this.ctx.globalAlpha=t.intensity,this.ctx.fillStyle=t.color,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore())}startRippleEffect(t,e,i=100){this.screenEffects.ripple.active=!0,this.screenEffects.ripple.x=t,this.screenEffects.ripple.y=e,this.screenEffects.ripple.radius=0,this.screenEffects.ripple.maxRadius=i}updateRippleEffect(){const t=this.screenEffects.ripple;t.active&&(t.radius+=8,t.radius>t.maxRadius&&(t.active=!1))}drawRippleEffect(){const t=this.screenEffects.ripple;t.active&&(this.ctx.save(),this.ctx.globalAlpha=.3*(1-t.radius/t.maxRadius),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}startGlitchEffect(t=.1,e=10){this.screenEffects.glitch.active=!0,this.screenEffects.glitch.intensity=t,this.screenEffects.glitch.duration=e}updateGlitchEffect(){const t=this.screenEffects.glitch;t.active&&(t.duration--,t.duration<=0&&(t.active=!1))}drawGlitchEffect(){this.screenEffects.glitch.active&&(this.ctx.save(),this.ctx.globalAlpha=.15,this.ctx.fillStyle=Math.random()>.5?"#ff0000":"#00ff00",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore())}updateScreenEffects(){this.updateScreenShake(),this.updateScreenFlash(),this.updateRippleEffect(),this.updateGlitchEffect()}drawScreenEffects(){this.enableEffects&&(this.drawScreenFlash(),this.drawRippleEffect(),this.drawGlitchEffect())}setShadow(t="rgba(0, 0, 0, 0.1)",e=5,i={x:0,y:2}){this.enableShadows&&(this.ctx.shadowColor=t,this.ctx.shadowBlur=e,this.ctx.shadowOffsetX=i.x,this.ctx.shadowOffsetY=i.y)}clearShadow(){this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0}getDimensions(){return{width:this.canvas.width,height:this.canvas.height}}getStats(){return{...this.stats}}setFeature(t,e){switch(t){case"textures":this.enableTextures=e;break;case"shadows":this.enableShadows=e;break;case"effects":this.enableEffects=e}}getContext(){return this.ctx}getPatterns(){return{...this.patterns}}createFloatingText(t,e,i,s="#FFD700"){const n=document.createElement("div");n.className="floating-text",n.style.cssText=`\n            position: absolute;\n            left: ${t}px;\n            top: ${e}px;\n            color: ${s};\n            font-size: 24px;\n            font-weight: bold;\n            pointer-events: none;\n            z-index: 1000;\n            animation: floatUp 1s ease-out forwards;\n        `,n.textContent=i,document.body.appendChild(n),setTimeout((()=>n.remove()),1e3)}destroy(){window.removeEventListener("resize",this.resizeCanvas),this.patterns={},this.canvas.style.transform="translate(0px, 0px)"}}class g{constructor(t,e={}){this.canvas=t,this.options={preventScroll:!0,debug:!1,...e},this.touches=new Map,this.mousePosition={x:0,y:0},this.isMouseDown=!1,this.boundHandlers={handleTouchStart:this.handleTouchStart.bind(this),handleTouchMove:this.handleTouchMove.bind(this),handleTouchEnd:this.handleTouchEnd.bind(this),handleMouseDown:this.handleMouseDown.bind(this),handleMouseMove:this.handleMouseMove.bind(this),handleMouseUp:this.handleMouseUp.bind(this),handleContextMenu:this.handleContextMenu.bind(this),preventScroll:this.preventScroll.bind(this),handleResize:this.handleResize.bind(this)},this.clickHandlers=[],this.moveHandlers=[],this.resizeHandlers=[],this.canvasBounds=null,this.updateCanvasBounds(),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("touchstart",this.boundHandlers.handleTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.boundHandlers.handleTouchMove,{passive:!1}),this.canvas.addEventListener("touchend",this.boundHandlers.handleTouchEnd,{passive:!1}),this.canvas.addEventListener("touchcancel",this.boundHandlers.handleTouchEnd,{passive:!1}),this.canvas.addEventListener("mousedown",this.boundHandlers.handleMouseDown),this.canvas.addEventListener("mousemove",this.boundHandlers.handleMouseMove),this.canvas.addEventListener("mouseup",this.boundHandlers.handleMouseUp),this.canvas.addEventListener("mouseleave",this.boundHandlers.handleMouseUp),this.canvas.addEventListener("contextmenu",this.boundHandlers.handleContextMenu),this.options.preventScroll&&document.body.addEventListener("touchmove",this.boundHandlers.preventScroll,{passive:!1}),window.addEventListener("resize",this.boundHandlers.handleResize),this.options.debug}updateCanvasBounds(){this.canvasBounds=this.canvas.getBoundingClientRect()}clientToCanvas(t,e){const i=this.canvasBounds||this.canvas.getBoundingClientRect(),s=this.canvas.width/i.width,n=this.canvas.height/i.height;return{x:(t-i.left)*s,y:(e-i.top)*n}}handleTouchStart(t){t.preventDefault();for(const e of t.changedTouches){const t=this.clientToCanvas(e.clientX,e.clientY);this.touches.set(e.identifier,{id:e.identifier,startX:t.x,startY:t.y,currentX:t.x,currentY:t.y,startTime:Date.now()}),this.triggerClick(t.x,t.y,"touch")}this.options.debug}handleTouchMove(t){t.preventDefault();for(const e of t.changedTouches){const t=this.touches.get(e.identifier);if(t){const i=this.clientToCanvas(e.clientX,e.clientY);t.currentX=i.x,t.currentY=i.y,this.triggerMove(i.x,i.y,"touch")}}}handleTouchEnd(t){t.preventDefault();for(const e of t.changedTouches)this.touches.delete(e.identifier);this.options.debug}handleMouseDown(t){const e=this.clientToCanvas(t.clientX,t.clientY);this.isMouseDown=!0,this.mousePosition=e,this.triggerClick(e.x,e.y,"mouse"),this.options.debug}handleMouseMove(t){const e=this.clientToCanvas(t.clientX,t.clientY);this.mousePosition=e,this.isMouseDown&&this.triggerMove(e.x,e.y,"mouse")}handleMouseUp(t){this.isMouseDown=!1,this.options.debug}handleContextMenu(t){t.preventDefault()}preventScroll(t){(t.target===this.canvas||this.canvas.contains(t.target))&&t.preventDefault()}handleResize(t){this.updateCanvasBounds();for(const t of this.resizeHandlers)t(this.canvas.width,this.canvas.height);this.options.debug}triggerClick(t,e,i){for(const s of this.clickHandlers){if(s(t,e,i))break}}triggerMove(t,e,i){for(const s of this.moveHandlers)s(t,e,i)}onClick(t){return this.clickHandlers.push(t),()=>{const e=this.clickHandlers.indexOf(t);-1!==e&&this.clickHandlers.splice(e,1)}}onMove(t){return this.moveHandlers.push(t),()=>{const e=this.moveHandlers.indexOf(t);-1!==e&&this.moveHandlers.splice(e,1)}}onResize(t){return this.resizeHandlers.push(t),()=>{const e=this.resizeHandlers.indexOf(t);-1!==e&&this.resizeHandlers.splice(e,1)}}getTouches(){return Array.from(this.touches.values())}getMousePosition(){return{...this.mousePosition}}isPointActive(t,e,i=0){if(this.isMouseDown){const s=this.mousePosition.x-t,n=this.mousePosition.y-e;if(Math.sqrt(s*s+n*n)<=i)return!0}for(const s of this.touches.values()){const n=s.currentX-t,a=s.currentY-e;if(Math.sqrt(n*n+a*a)<=i)return!0}return!1}destroy(){this.canvas.removeEventListener("touchstart",this.boundHandlers.handleTouchStart),this.canvas.removeEventListener("touchmove",this.boundHandlers.handleTouchMove),this.canvas.removeEventListener("touchend",this.boundHandlers.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.boundHandlers.handleTouchEnd),this.canvas.removeEventListener("mousedown",this.boundHandlers.handleMouseDown),this.canvas.removeEventListener("mousemove",this.boundHandlers.handleMouseMove),this.canvas.removeEventListener("mouseup",this.boundHandlers.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.boundHandlers.handleMouseUp),this.canvas.removeEventListener("contextmenu",this.boundHandlers.handleContextMenu),this.options.preventScroll&&document.body.removeEventListener("touchmove",this.boundHandlers.preventScroll),window.removeEventListener("resize",this.boundHandlers.handleResize),this.clickHandlers=[],this.moveHandlers=[],this.resizeHandlers=[],this.touches.clear(),this.options.debug}}const f=.15,v=12,x=.7,y=.8,b=.01,w=.5,C=.05,S=.98;class M{constructor(t={}){this.bounds={width:t.width||480,height:t.height||600},this.gravity=t.gravity||f,this.terminalVelocity=t.terminalVelocity||v,this.bounceDamping=t.bounceDamping||x,this.friction=t.friction||y,this.enableRotation=!1!==t.enableRotation,this.enableSway=!1!==t.enableSway,this.enableBounce=!1!==t.enableBounce}updateBounds(t,e){this.bounds.width=t,this.bounds.height=e}applyGravity(t,e=1){const i=t+this.gravity*e;return Math.min(i,this.terminalVelocity)}updatePosition(t,e,i=1){return{x:t.x+e.x*i,y:t.y+e.y*i}}applySway(t,e,i=1){if(!this.enableSway)return t;return t+Math.sin(e*C+i*Math.PI)*w}updateRotation(t,e,i=!1){if(!this.enableRotation)return{rotation:0,rotationSpeed:0};const s=i?e*S:e;return{rotation:(t+e)%(2*Math.PI),rotationSpeed:Math.abs(s)<b?0:s}}checkBounds(t,e){const i=e||this.bounds,s=t.width||t.size||0,n=t.height||t.size||0,a=t.x<0,o=t.x+s>i.width,r=t.y<0,h=t.y+n>i.height;return{inBounds:!(a||o||r||h),left:a,right:o,top:r,bottom:h,offScreenBottom:t.y>i.height,offScreenTop:t.y+n<0}}applyBoundaryCollision(t,e){const i={x:t.x,y:t.y,vx:t.vx||0,vy:t.vy||0,bounced:!1};return e.left&&(i.x=0,this.enableBounce?(i.vx=Math.abs(i.vx)*this.bounceDamping,i.bounced=!0):i.vx=0),e.right&&(i.x=this.bounds.width-t.width,this.enableBounce?(i.vx=-Math.abs(i.vx)*this.bounceDamping,i.bounced=!0):i.vx=0),e.bottom&&t.vy>0&&(i.y=this.bounds.height-t.height,this.enableBounce?(i.vy=-Math.abs(i.vy)*this.bounceDamping,i.vx*=this.friction,i.bounced=!0,Math.abs(i.vy)<b&&(i.vy=0)):i.vy=0),i}checkCircleCollision(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)<t.radius+e.radius}checkPointCircleCollision(t,e,i){const s=t-i.x,n=e-i.y;return Math.sqrt(s*s+n*n)<=i.radius}checkRectCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}checkPointRectCollision(t,e,i){return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height}isClicked(t,e,i){if(void 0!==i.radius){const s=i.x+(i.size||2*i.radius)/2,n=i.y+(i.size||2*i.radius)/2;return this.checkPointCircleCollision(t,e,{x:s,y:n,radius:i.radius})}return void 0!==i.width&&void 0!==i.height?this.checkPointRectCollision(t,e,i):void 0!==i.size&&this.checkPointRectCollision(t,e,{x:i.x,y:i.y,width:i.size,height:i.size})}distance(t,e,i,s){const n=i-t,a=s-e;return Math.sqrt(n*n+a*a)}angle(t,e,i,s){return Math.atan2(s-e,i-t)}normalize(t,e){const i=Math.sqrt(t*t+e*e);return 0===i?{x:0,y:0}:{x:t/i,y:e/i}}updateEntity(t,e=1,i={}){const s={x:t.x,y:t.y,vx:t.vx||0,vy:t.vy||0,rotation:t.rotation||0,rotationSpeed:t.rotationSpeed||0};!1===t.hasGravity||i.disableGravity||(s.vy=this.applyGravity(s.vy,t.gravityMultiplier||1));const n=this.updatePosition({x:s.x,y:s.y},{x:s.vx,y:s.vy},e);if(s.x=n.x,s.y=n.y,void 0!==t.sway&&this.enableSway&&(s.x=this.applySway(s.x,i.time||0,t.sway)),this.enableRotation){const e=this.updateRotation(s.rotation,s.rotationSpeed,t.rotationDamping||!1);s.rotation=e.rotation,s.rotationSpeed=e.rotationSpeed}const a=this.checkBounds({x:s.x,y:s.y,width:t.width||t.size||0,height:t.height||t.size||0});if(!a.inBounds&&t.bounceOnBounds){const e=this.applyBoundaryCollision({x:s.x,y:s.y,vx:s.vx,vy:s.vy,width:t.width||t.size||0,height:t.height||t.size||0},a);s.x=e.x,s.y=e.y,s.vx=e.vx,s.vy=e.vy,s.bounced=e.bounced}return s.offScreen=a.offScreenBottom||a.offScreenTop,s.boundaryCheck=a,s}predictPosition(t,e,i=1){let s=t.x,n=t.y,a=t.vx||0,o=t.vy||0;for(let r=0;r<e;r++)!1!==t.hasGravity&&(o=this.applyGravity(o,t.gravityMultiplier||1)),s+=a*i,n+=o*i;return{x:s,y:n}}calculateIntercept(t,e,i){const s=e.x-t.x,n=e.y-t.y,a=e.vx||0,o=e.vy||0,r=a*a+o*o-i*i,h=2*(s*a+n*o),l=h*h-4*r*(s*s+n*n);if(l<0)return null;const c=(-h+Math.sqrt(l))/(2*r),d=(-h-Math.sqrt(l))/(2*r),u=c>0&&d>0?Math.min(c,d):Math.max(c,d);return u<0?null:{x:e.x+a*u,y:e.y+o*u,time:u}}}function T(t,e){return Math.random()*(e-t)+t}new M,Array.from({length:360},((t,e)=>Math.sin(e*Math.PI/180))),Array.from({length:360},((t,e)=>Math.cos(e*Math.PI/180)));class F{constructor(t,e,i=10,s=100){this.createFn=t,this.resetFn=e,this.maxSize=s,this.pool=[],this.activeCount=0,this.totalCreated=0,this.totalReused=0;for(let t=0;t<i;t++)this.pool.push(this.createFn()),this.totalCreated++}get(...t){let e;return this.pool.length>0?(e=this.pool.pop(),this.totalReused++):(e=this.createFn(),this.totalCreated++),this.resetFn&&this.resetFn(e,...t),this.activeCount++,e}release(t){t&&(this.pool.length<this.maxSize&&this.pool.push(t),this.activeCount=Math.max(0,this.activeCount-1))}releaseAll(t){t.forEach((t=>this.release(t)))}clear(){this.pool.length=0,this.activeCount=0,this.totalCreated=0,this.totalReused=0}getStats(){return{poolSize:this.pool.length,activeCount:this.activeCount,totalCreated:this.totalCreated,totalReused:this.totalReused,reuseRatio:this.totalCreated>0?this.totalReused/this.totalCreated:0,maxSize:this.maxSize}}isHealthy(){return this.getStats().reuseRatio>.5}resize(t){for(this.maxSize=t;this.pool.length>this.maxSize;)this.pool.pop()}preWarm(t){for(let e=0;e<t&&this.pool.length<this.maxSize;e++)this.pool.push(this.createFn()),this.totalCreated++}}class P{constructor(){this.pools=new Map}createPool(t,e,i,s=10,n=100){const a=new F(e,i,s,n);return this.pools.set(t,a),a}getPool(t){return this.pools.get(t)}get(t,...e){const i=this.pools.get(t);return i?i.get(...e):null}release(t,e){const i=this.pools.get(t);i&&i.release(e)}getStats(){const t={};for(const[e,i]of this.pools)t[e]=i.getStats();return t}clearAll(){for(const t of this.pools.values())t.clear()}areAllPoolsHealthy(){for(const t of this.pools.values())if(!t.isHealthy())return!1;return!0}getMemorySavings(){let t=0,e=0;for(const i of this.pools.values()){const s=i.getStats();t+=s.totalReused,e+=s.totalCreated}return{objectsReused:t,objectsCreated:e,savings:e>0?t/e:0}}}class k{constructor(t={}){this.enabled=!1!==t.enabled,this.sampleSize=t.sampleSize||60,this.targetFPS=t.targetFPS||60,this.lowFPSThreshold=t.lowFPSThreshold||45,this.criticalFPSThreshold=t.criticalFPSThreshold||30,this.frameTimes=[],this.lastFrameTime=0,this.frameCount=0,this.stats={currentFPS:60,averageFPS:60,minFPS:60,maxFPS:60,frameTimeMS:16.67,droppedFrames:0,performanceLevel:"high"},this.performanceLevels=[],this.levelChangeDelay=t.levelChangeDelay||120,this.qualitySettings={high:{maxParticles:200,enableShadows:!0,enableTextures:!0,enableEffects:!0,particleDetail:1,renderScale:1},medium:{maxParticles:100,enableShadows:!0,enableTextures:!0,enableEffects:!0,particleDetail:.8,renderScale:1},low:{maxParticles:50,enableShadows:!1,enableTextures:!1,enableEffects:!0,particleDetail:.6,renderScale:.9},critical:{maxParticles:25,enableShadows:!1,enableTextures:!1,enableEffects:!1,particleDetail:.4,renderScale:.8}},this.callbacks={performanceLevelChanged:[],frameDropDetected:[],statsUpdated:[]},this.debugMode=t.debugMode||!1}update(t){if(!this.enabled)return;if(0===this.lastFrameTime)return void(this.lastFrameTime=t);const e=t-this.lastFrameTime;this.lastFrameTime=t,this.frameCount++,this.frameTimes.push(e),this.frameTimes.length>this.sampleSize&&this.frameTimes.shift(),this.updateStats(),this.checkPerformanceLevel(),this.emit("statsUpdated",this.stats)}updateStats(){if(0===this.frameTimes.length)return;const t=this.frameTimes,e=t[t.length-1],i=Math.min(1e3/e,this.targetFPS),s=t.reduce(((t,e)=>t+e),0)/t.length,n=Math.min(1e3/s,this.targetFPS),a=Math.min(1e3/Math.max(...t),this.targetFPS),o=Math.min(1e3/Math.min(...t),this.targetFPS),r=1e3/this.targetFPS,h=t.filter((t=>t>1.5*r)).length;this.stats={currentFPS:Math.round(10*i)/10,averageFPS:Math.round(10*n)/10,minFPS:Math.round(10*a)/10,maxFPS:Math.round(10*o)/10,frameTimeMS:Math.round(100*e)/100,droppedFrames:h,performanceLevel:this.stats.performanceLevel},e>2*r&&this.emit("frameDropDetected",{frameTime:e,targetTime:r})}checkPerformanceLevel(){let t=this.determinePerformanceLevel();if(this.performanceLevels.push(t),this.performanceLevels.length>this.levelChangeDelay&&this.performanceLevels.shift(),this.performanceLevels.length>=this.levelChangeDelay){const t=this.performanceLevels.slice(-30),e={};t.forEach((t=>{e[t]=(e[t]||0)+1}));const i=Object.keys(e).reduce(((t,i)=>e[t]>e[i]?t:i));if(i!==this.stats.performanceLevel){const t=this.stats.performanceLevel;this.stats.performanceLevel=i,this.debugMode,this.emit("performanceLevelChanged",{oldLevel:t,newLevel:i,settings:this.getQualitySettings()})}}}determinePerformanceLevel(){const{averageFPS:t,droppedFrames:e}=this.stats,i=e/this.sampleSize;return t>=.9*this.targetFPS&&i<.1?"high":t>=this.lowFPSThreshold&&i<.2?"medium":t>=this.criticalFPSThreshold&&i<.4?"low":"critical"}getQualitySettings(){return{...this.qualitySettings[this.stats.performanceLevel]}}getStats(){return{...this.stats}}isPerformanceGood(){return this.stats.averageFPS>=this.lowFPSThreshold&&this.stats.droppedFrames/this.sampleSize<.2}isPerformanceCritical(){return"critical"===this.stats.performanceLevel}setPerformanceLevel(t){if(this.qualitySettings[t]){const e=this.stats.performanceLevel;this.stats.performanceLevel=t,this.performanceLevels=new Array(this.levelChangeDelay).fill(t),this.emit("performanceLevelChanged",{oldLevel:e,newLevel:t,settings:this.getQualitySettings(),forced:!0})}}reset(){this.frameTimes=[],this.lastFrameTime=0,this.frameCount=0,this.performanceLevels=[],this.stats={currentFPS:60,averageFPS:60,minFPS:60,maxFPS:60,frameTimeMS:16.67,droppedFrames:0,performanceLevel:"high"}}setEnabled(t){this.enabled=t,t||this.reset()}setDebugMode(t){this.debugMode=t}on(t,e){this.callbacks[t]&&this.callbacks[t].push(e)}off(t,e){if(this.callbacks[t]){const i=this.callbacks[t].indexOf(e);i>-1&&this.callbacks[t].splice(i,1)}}emit(t,e){this.callbacks[t]&&this.callbacks[t].forEach((t=>{try{t(e)}catch(t){}}))}getReport(){return{enabled:this.enabled,frameCount:this.frameCount,stats:this.getStats(),qualitySettings:this.getQualitySettings(),isHealthy:this.isPerformanceGood(),isCritical:this.isPerformanceCritical(),sampleSize:this.frameTimes.length,targetFPS:this.targetFPS}}}class E{constructor(t={}){this.enabled=t.enabled||!1,this.position=t.position||"top-left",this.updateInterval=t.updateInterval||250,this.maxHistory=t.maxHistory||100,this.container=null,this.elements={},this.performanceMonitor=null,this.poolManager=null,this.fpsHistory=[],this.lastUpdate=0,this.showFPS=!1!==t.showFPS,this.showPools=!1!==t.showPools,this.showQuality=!1!==t.showQuality,this.showDetails=t.showDetails||!1,this.showGraph=t.showGraph||!1,this.enabled&&this.createUI()}init(t,e){this.performanceMonitor=t,this.poolManager=e}createUI(){this.container=document.createElement("div"),this.container.id="performance-ui",this.container.style.cssText=this.getContainerStyles(),this.showFPS&&this.createFPSSection(),this.showQuality&&this.createQualitySection(),this.showPools&&this.createPoolsSection(),this.showDetails&&this.createDetailsSection(),this.showGraph&&this.createGraphSection(),this.createToggleButton(),document.body.appendChild(this.container)}getContainerStyles(){return"\n            position: fixed;\n            z-index: 10000;\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            padding: 10px;\n            border-radius: 5px;\n            min-width: 200px;\n            max-width: 300px;\n            backdrop-filter: blur(5px);\n        "+{"top-left":"top: 10px; left: 10px;","top-right":"top: 10px; right: 10px;","bottom-left":"bottom: 10px; left: 10px;","bottom-right":"bottom: 10px; right: 10px;"}[this.position]}createFPSSection(){const t=document.createElement("div");t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üéØ Performance</div>\n            <div>FPS: <span id="perf-fps">--</span></div>\n            <div>Avg: <span id="perf-avg-fps">--</span></div>\n            <div>Min: <span id="perf-min-fps">--</span></div>\n            <div>Frame: <span id="perf-frame-time">--</span>ms</div>\n            <div>Drops: <span id="perf-drops">--</span></div>\n        ',this.container.appendChild(t),this.elements.fps=document.getElementById("perf-fps"),this.elements.avgFps=document.getElementById("perf-avg-fps"),this.elements.minFps=document.getElementById("perf-min-fps"),this.elements.frameTime=document.getElementById("perf-frame-time"),this.elements.drops=document.getElementById("perf-drops")}createQualitySection(){const t=document.createElement("div");t.style.marginTop="10px",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">‚öôÔ∏è Quality</div>\n            <div>Level: <span id="perf-quality-level">--</span></div>\n            <div>Particles: <span id="perf-max-particles">--</span></div>\n            <div>Shadows: <span id="perf-shadows">--</span></div>\n            <div>Effects: <span id="perf-effects">--</span></div>\n        ',this.container.appendChild(t),this.elements.qualityLevel=document.getElementById("perf-quality-level"),this.elements.maxParticles=document.getElementById("perf-max-particles"),this.elements.shadows=document.getElementById("perf-shadows"),this.elements.effects=document.getElementById("perf-effects")}createPoolsSection(){const t=document.createElement("div");t.style.marginTop="10px",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üé± Object Pools</div>\n            <div id="perf-pools-content">\n                \x3c!-- Pool stats will be inserted here --\x3e\n            </div>\n        ',this.container.appendChild(t),this.elements.poolsContent=document.getElementById("perf-pools-content")}createDetailsSection(){const t=document.createElement("div");t.style.marginTop="10px",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üìä Details</div>\n            <div>Memory: <span id="perf-memory">--</span></div>\n            <div>Entities: <span id="perf-entities">--</span></div>\n            <div>Draw Calls: <span id="perf-draw-calls">--</span></div>\n            <div>Performance: <span id="perf-health">--</span></div>\n        ',this.container.appendChild(t),this.elements.memory=document.getElementById("perf-memory"),this.elements.entities=document.getElementById("perf-entities"),this.elements.drawCalls=document.getElementById("perf-draw-calls"),this.elements.health=document.getElementById("perf-health")}createGraphSection(){const t=document.createElement("div");t.style.marginTop="10px",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üìà FPS Graph</div>\n            <canvas id="perf-graph" width="180" height="50" style="background: rgba(255,255,255,0.1); border-radius: 3px;"></canvas>\n        ',this.container.appendChild(t),this.elements.graph=document.getElementById("perf-graph"),this.graphCtx=this.elements.graph.getContext("2d")}createToggleButton(){const t=document.createElement("button");t.innerHTML="üëÅÔ∏è",t.style.cssText="\n            position: absolute;\n            top: -5px;\n            right: -5px;\n            width: 20px;\n            height: 20px;\n            border: none;\n            border-radius: 50%;\n            background: rgba(255, 255, 255, 0.2);\n            color: white;\n            font-size: 10px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        ",t.onclick=()=>this.toggle(),this.container.appendChild(t)}update(t,e={}){if(!this.enabled||!this.container||!this.performanceMonitor)return;if(t-this.lastUpdate<this.updateInterval)return;this.lastUpdate=t;const i=this.performanceMonitor.getStats(),s=this.performanceMonitor.getQualitySettings();this.showFPS&&this.updateFPSDisplay(i),this.showQuality&&this.updateQualityDisplay(i,s),this.showPools&&this.poolManager&&this.updatePoolsDisplay(),this.showDetails&&this.updateDetailsDisplay(i,e),this.showGraph&&this.updateGraph(i.currentFPS)}updateFPSDisplay(t){this.elements.fps&&(this.elements.fps.textContent=t.currentFPS.toFixed(1),this.elements.fps.style.color=this.getFPSColor(t.currentFPS)),this.elements.avgFps&&(this.elements.avgFps.textContent=t.averageFPS.toFixed(1)),this.elements.minFps&&(this.elements.minFps.textContent=t.minFPS.toFixed(1)),this.elements.frameTime&&(this.elements.frameTime.textContent=t.frameTimeMS.toFixed(2)),this.elements.drops&&(this.elements.drops.textContent=t.droppedFrames,this.elements.drops.style.color=t.droppedFrames>5?"#ff6b6b":"#51cf66")}updateQualityDisplay(t,e){this.elements.qualityLevel&&(this.elements.qualityLevel.textContent=t.performanceLevel,this.elements.qualityLevel.style.color=this.getQualityColor(t.performanceLevel)),this.elements.maxParticles&&(this.elements.maxParticles.textContent=e.maxParticles),this.elements.shadows&&(this.elements.shadows.textContent=e.enableShadows?"‚úÖ":"‚ùå"),this.elements.effects&&(this.elements.effects.textContent=e.enableEffects?"‚úÖ":"‚ùå")}updatePoolsDisplay(){const t=this.poolManager.getStats();let e="";for(const[i,s]of Object.entries(t)){const t=(s.activeCount/(s.poolSize+s.activeCount)*100).toFixed(0),n=(100*s.reuseRatio).toFixed(0);e+=`\n                <div style="font-size: 10px; margin: 2px 0;">\n                    <div>${i}: ${s.activeCount}/${s.poolSize+s.activeCount}</div>\n                    <div style="color: #888;">Use: ${t}% | Reuse: ${n}%</div>\n                </div>\n            `}this.elements.poolsContent&&(this.elements.poolsContent.innerHTML=e)}updateDetailsDisplay(t,e){if(this.elements.memory&&window.performance&&window.performance.memory){const t=(window.performance.memory.usedJSHeapSize/1024/1024).toFixed(1);this.elements.memory.textContent=`${t}MB`}if(this.elements.entities){const t=(e.particles||[]).length+(e.ingredients||[]).length+(e.powerUps||[]).length;this.elements.entities.textContent=t}if(this.elements.drawCalls&&e.renderer){const t=e.renderer.getStats();this.elements.drawCalls.textContent=t.drawCalls||"--"}if(this.elements.health){const t=this.performanceMonitor.isPerformanceGood();this.elements.health.textContent=t?"‚úÖ Good":"‚ö†Ô∏è Poor",this.elements.health.style.color=t?"#51cf66":"#ff6b6b"}}updateGraph(t){if(this.graphCtx){this.fpsHistory.push(t),this.fpsHistory.length>this.maxHistory&&this.fpsHistory.shift(),this.graphCtx.clearRect(0,0,180,50),this.graphCtx.strokeStyle="rgba(255, 255, 255, 0.1)",this.graphCtx.lineWidth=1;for(let t=0;t<=50;t+=10)this.graphCtx.beginPath(),this.graphCtx.moveTo(0,t),this.graphCtx.lineTo(180,t),this.graphCtx.stroke();if(this.fpsHistory.length>1){this.graphCtx.strokeStyle="#51cf66",this.graphCtx.lineWidth=2,this.graphCtx.beginPath();for(let t=0;t<this.fpsHistory.length;t++){const e=t/this.fpsHistory.length*180,i=50-this.fpsHistory[t]/60*50;0===t?this.graphCtx.moveTo(e,i):this.graphCtx.lineTo(e,i)}this.graphCtx.stroke()}this.graphCtx.strokeStyle="rgba(255, 255, 255, 0.3)",this.graphCtx.lineWidth=1,this.graphCtx.setLineDash([2,2]),this.graphCtx.beginPath(),this.graphCtx.moveTo(0,0),this.graphCtx.lineTo(180,0),this.graphCtx.stroke(),this.graphCtx.setLineDash([])}}getFPSColor(t){return t>=55?"#51cf66":t>=45?"#ffd43b":t>=30?"#ff8c42":"#ff6b6b"}getQualityColor(t){return{high:"#51cf66",medium:"#ffd43b",low:"#ff8c42",critical:"#ff6b6b"}[t]||"#ffffff"}toggle(){this.container&&(this.enabled=!this.enabled,this.container.style.display=this.enabled?"block":"none")}show(){this.enabled=!0,this.container?this.container.style.display="block":this.createUI()}hide(){this.enabled=!1,this.container&&(this.container.style.display="none")}destroy(){this.container&&(this.container.remove(),this.container=null),this.elements={}}setPosition(t){if(this.position=t,this.container){const t=this.getContainerStyles();this.container.style.cssText=t}}configure(t){Object.assign(this,t),this.container&&(this.container.remove(),this.createUI())}}class I{constructor(e,i={}){this.canvas=e,this.ctx=e.getContext("2d"),this.config={initialLives:3,initialSpeed:4,spawnRate:40,maxOrders:3,powerUpSpawnInterval:900,difficultyIncreaseRate:1e-4,...i},this.state=new t,this.state.core.lives=this.config.initialLives,this.audioSystem=new d,this.renderer=new m(this.canvas),this.inputSystem=new g(this.canvas),this.physicsSystem=new M,this.performanceMonitor=new k({enabled:!1!==i.enablePerformanceMonitoring,debugMode:i.debugPerformance||!1}),this.performanceUI=new E({enabled:i.showPerformanceUI||!1,position:i.performanceUIPosition||"top-right",showFPS:!0,showPools:!0,showQuality:!0,showDetails:i.debugPerformance||!1,showGraph:i.debugPerformance||!1}),this.ingredients=[],this.orders=[],this.particles=[],this.powerUps=[],this.poolManager=new P,this.initializeObjectPools(),this.animationId=null,this.lastTime=0,this.deltaTime=0,this.frameCount=0,this.isPaused=!1,this.lastSpawn=0,this.lastPowerUpSpawn=0,this.orderTemplates=[{name:"Classic Burger",ingredients:["bun_bottom","patty","cheese","lettuce","tomato","bun_top"],time:30},{name:"Simple Burger",ingredients:["bun_bottom","patty","bun_top"],time:20},{name:"Cheese Burger",ingredients:["bun_bottom","patty","cheese","bun_top"],time:25},{name:"Veggie Burger",ingredients:["bun_bottom","lettuce","tomato","onion","pickle","bun_top"],time:30},{name:"Bacon Burger",ingredients:["bun_bottom","patty","bacon","cheese","bun_top"],time:35},{name:"Breakfast Burger",ingredients:["bun_bottom","patty","egg","bacon","cheese","bun_top"],time:40}],this.update=this.update.bind(this),this.render=this.render.bind(this),this.gameLoop=this.gameLoop.bind(this),this.handleInput=this.handleInput.bind(this),this.setupInputHandlers(),this.renderer.initializePatterns(),this.loadHighScore()}initializeObjectPools(){this.poolManager.createPool("particle",i.createFactory(),i.resetParticle,50,200),this.poolManager.createPool("celebrationParticle",i.createFactory(),i.resetParticle,20,100),this.poolManager.createPool("ingredient",(()=>new o("bun_top",{canvasWidth:this.canvas.width,canvasHeight:this.canvas.height})),((t,e,i={})=>{t.init(e,{...i,canvasWidth:this.canvas.width,canvasHeight:this.canvas.height})}),15,50),this.setupPerformanceCallbacks(),this.performanceUI.init(this.performanceMonitor,this.poolManager)}setupPerformanceCallbacks(){this.performanceMonitor.on("performanceLevelChanged",(t=>{const{newLevel:e,settings:i}=t;this.applyQualitySettings(i)})),this.performanceMonitor.on("frameDropDetected",(t=>{this.config.debugPerformance}))}applyQualitySettings(t){this.renderer.setFeature("shadows",t.enableShadows),this.renderer.setFeature("textures",t.enableTextures),this.renderer.setFeature("effects",t.enableEffects),this.maxParticles=t.maxParticles;const e=this.poolManager.getPool("particle"),i=this.poolManager.getPool("celebrationParticle");if(e&&e.resize(Math.floor(1.5*t.maxParticles)),i&&i.resize(Math.floor(.5*t.maxParticles)),this.particles.length>t.maxParticles){this.particles.splice(t.maxParticles).forEach((t=>{"celebration"===t.type?this.poolManager.release("celebrationParticle",t):this.poolManager.release("particle",t)}))}}setupInputHandlers(){this.unregisterClick=this.inputSystem.onClick((t=>this.handleInput(t)))}handleInput(t){if("playing"!==this.state.gameState||this.isPaused)return;const{x:e,y:i}=t;for(let t=this.powerUps.length-1;t>=0;t--){const s=this.powerUps[t];if(s.isClicked(e,i))return void this.collectPowerUp(s,t)}for(let t=this.ingredients.length-1;t>=0;t--){const s=this.ingredients[t];if(s.isClicked(e,i))return void this.collectIngredient(s,t)}}collectPowerUp(t,e){this.state.activatePowerUp(t.type),this.audioSystem.playPowerUpActivate(t.type),this.renderer.startScreenFlash(t.data.color,.2,8);const i=t.x+t.size/2,s=t.y+t.size/2;for(let e=0;e<3;e++){const e=this.poolManager.get("celebrationParticle",i+T(-50,50),s+T(-50,50),t.data.color,t.data.emoji,{});this.particles.push(e)}this.powerUps.splice(e,1)}collectIngredient(t,e){let i=null,s="wrong";for(const e of this.orders)if(s=e.checkIngredient(t.type),"wrong"!==s){i=e;break}if("wrong"!==s){const e=this.calculatePoints(t,i);if(this.state.addScore(e),"completed"===s)this.completeOrder(i);else{this.state.incrementCombo(),this.audioSystem.playCollect();for(let e=0;e<5;e++){const e=this.poolManager.get("particle",t.x+t.data.size/2,t.y+t.data.size/2,"#00FF00","","star",{});this.particles.push(e)}}this.createFloatingText(`+${e}`,t.x+t.data.size/2,t.y,"#00FF00")}else{this.state.resetCombo(),this.renderer.startScreenShake(10,15),this.audioSystem.playError();for(let e=0;e<3;e++){const e=this.poolManager.get("particle",t.x+t.data.size/2,t.y+t.data.size/2,"#FF0000","‚úó","default",{});this.particles.push(e)}}t.collected=!0,this.ingredients.splice(e,1),this.poolManager.release("ingredient",t)}calculatePoints(t,e){const i=Math.floor(e.timeLeft/1e3),s=this.state.combo,n=this.state.activePowerUps.scoreMultiplier.active?this.state.activePowerUps.scoreMultiplier.multiplier:1;return Math.floor((10+i)*s*n)}completeOrder(t){this.state.incrementCombo(5);const e=Math.floor(100*this.state.combo*(this.state.activePowerUps.scoreMultiplier.active?2:1));this.state.addScore(e),this.audioSystem.playOrderComplete(),this.renderer.startScreenFlash("#FFD700",.3,10);const i=t.x+t.width/2,s=t.y+t.height/2;for(let t=0;t<10;t++){const e=t/10*Math.PI*2,n=T(3,6),a=this.poolManager.get("celebrationParticle",i,s,p(),"‚≠ê",{vx:Math.cos(e)*n,vy:Math.sin(e)*n});this.particles.push(a)}this.createFloatingText(`+${e}`,i,s,"#FFD700");const n=this.orders.indexOf(t);n>-1&&this.orders.splice(n,1)}createFloatingText(t,e,i,s){const n=document.createElement("div");n.className="floating-text",n.textContent=t,n.style.left=`${e}px`,n.style.top=`${i}px`,n.style.color=s,n.style.fontSize="24px",document.getElementById("ui").appendChild(n),setTimeout((()=>{n.remove()}),1e3)}spawnIngredient(){const t=new Set;if(this.orders.forEach((e=>{if(e.currentIndex<e.ingredients.length){t.add(e.ingredients[e.currentIndex]);const i=o.getAvailableTypes(),s=i[Math.floor(Math.random()*i.length)];t.add(s)}})),t.size>0){const e=Array.from(t),i=e[Math.floor(Math.random()*e.length)],s=this.poolManager.get("ingredient",i,{canvasWidth:this.canvas.width,canvasHeight:this.canvas.height}),n=1+this.state.score*this.config.difficultyIncreaseRate;s.speed*=n,s.baseSpeed*=n,this.ingredients.push(s)}}spawnOrder(){if(this.orders.length<this.config.maxOrders){const t=this.orderTemplates[Math.floor(Math.random()*this.orderTemplates.length)];this.orders.push(new h(t)),this.audioSystem.playNewOrder()}}spawnPowerUp(){if(this.powerUps.length<1&&this.frameCount-this.lastPowerUpSpawn>this.config.powerUpSpawnInterval){const t=Object.keys(n.getPowerUpTypes()),e=t[Math.floor(Math.random()*t.length)];this.powerUps.push(new n(e)),this.lastPowerUpSpawn=this.frameCount}}update(t){if("playing"===this.state.gameState&&!this.isPaused){this.frameCount++,this.state.update(t),this.renderer.updateColorTheme&&this.renderer.updateColorTheme(this.state.combo,this.state.score,this.frameCount),this.frameCount-this.lastSpawn>this.config.spawnRate&&(this.spawnIngredient(),this.lastSpawn=this.frameCount),(0===this.orders.length||this.orders.length<this.config.maxOrders&&Math.random()<.01)&&this.spawnOrder(),this.spawnPowerUp();for(let t=this.ingredients.length-1;t>=0;t--){const e=this.ingredients[t];e.update(this.frameCount,this.state.activePowerUps),e.y>this.canvas.height+50&&(this.ingredients.splice(t,1),this.poolManager.release("ingredient",e))}for(let e=this.orders.length-1;e>=0;e--){this.orders[e].update(t,this.state.activePowerUps)||(this.orders.splice(e,1),this.state.loseLife(),this.audioSystem.playOrderExpire(),this.renderer.startScreenShake(20,30),this.state.lives<=0&&this.gameOver())}for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.update(this.frameCount),e.life<=0&&(this.particles.splice(t,1),"celebration"===e.type?this.poolManager.release("celebrationParticle",e):this.poolManager.release("particle",e))}for(let t=this.powerUps.length-1;t>=0;t--){const e=this.powerUps[t];e.update(),e.y>this.canvas.height+50&&this.powerUps.splice(t,1)}this.renderer.updateScreenEffects(),this.updateUI()}}render(){this.renderer.clear(this.canvas.width,this.canvas.height),this.renderer.applyScreenShake(),this.renderer.drawBackground(this.canvas.width,this.canvas.height),this.orders.forEach(((t,e)=>{t.draw(this.ctx,e,this.frameCount,this.renderer)})),this.ingredients.forEach((t=>{t.draw(this.ctx,this.frameCount)})),this.powerUps.forEach((t=>{t.draw(this.ctx,this.frameCount)})),this.particles.forEach((t=>{t.draw(this.ctx,this.frameCount)})),this.renderer.applyScreenFlash(this.canvas.width,this.canvas.height),this.ctx.setTransform(1,0,0,1,0,0)}gameLoop(t){this.lastTime||(this.lastTime=t),this.performanceMonitor.update(t),this.deltaTime=t-this.lastTime,this.lastTime=t,this.frameCount++,this.update(this.deltaTime),this.render(),this.performanceUI.update(t,{particles:this.particles,ingredients:this.ingredients,powerUps:this.powerUps,renderer:this.renderer}),this.animationId=requestAnimationFrame((t=>this.gameLoop(t)))}updateUI(){const t=document.getElementById("score");t&&(t.textContent=`Score: ${this.state.score}`,this.state.scoreChanged&&(t.classList.add("bounce"),setTimeout((()=>t.classList.remove("bounce")),400),this.state.scoreChanged=!1));const e=document.getElementById("combo");e&&(e.textContent=`Combo: x${this.state.combo}`,this.state.comboChanged&&(e.classList.add("pulse"),setTimeout((()=>e.classList.remove("pulse")),300),this.state.comboChanged=!1));const i=document.getElementById("lives");i&&(i.textContent="‚ù§Ô∏è".repeat(this.state.lives),this.state.livesChanged&&(i.classList.add("shake"),setTimeout((()=>i.classList.remove("shake")),500),this.state.livesChanged=!1));const s=document.getElementById("powerUpStatus");if(s){s.innerHTML="";for(const[t,e]of Object.entries(this.state.activePowerUps))if(e.active){const i=document.createElement("div");i.className=`power-up-indicator ${t.toLowerCase().replace(/([A-Z])/g,"-$1").toLowerCase()}`;const a=n.getPowerUpTypes()[t];i.innerHTML=`\n                        <span>${a.emoji}</span>\n                        <span>${a.name}</span>\n                        <span class="power-up-timer">${Math.ceil(e.timeLeft/1e3)}s</span>\n                    `,s.appendChild(i)}}}gameOver(){this.state.gameState="gameOver",this.audioSystem.playGameOver(),this.state.score>this.state.highScore&&(this.state.highScore=this.state.score,this.saveHighScore());const t=document.getElementById("gameOver");t&&(t.style.display="block",document.getElementById("finalScore").textContent=`Final Score: ${this.state.score}`,document.getElementById("highScore").textContent=`High Score: ${this.state.highScore}`)}loadHighScore(){try{const t=localStorage.getItem("burgerDropHighScore");t&&(this.state.highScore=parseInt(t)||0)}catch(t){}}saveHighScore(){try{localStorage.setItem("burgerDropHighScore",this.state.highScore.toString())}catch(t){}}start(){const t=document.getElementById("startScreen");t&&(t.style.display="none"),this.state.startGame(),this.particles.forEach((t=>{"celebration"===t.type?this.poolManager.release("celebrationParticle",t):this.poolManager.release("particle",t)})),this.ingredients.forEach((t=>{this.poolManager.release("ingredient",t)})),this.ingredients=[],this.orders=[],this.particles=[],this.powerUps=[],this.frameCount=0,this.lastSpawn=0,this.lastPowerUpSpawn=0,this.audioSystem.startBackgroundMusic(),this.state.gameState="playing",this.lastTime=0,this.gameLoop(0)}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.audioSystem.stopBackgroundMusic(),this.state.gameState="stopped"}togglePerformanceUI(){this.performanceUI.toggle()}showPerformanceUI(){this.performanceUI.show()}hidePerformanceUI(){this.performanceUI.hide()}pause(){this.isPaused=!this.isPaused,this.isPaused?this.audioSystem.pauseBackgroundMusic():this.audioSystem.resumeBackgroundMusic()}resize(){const t=this.poolManager.getPool("ingredient");t&&(t.config.canvasWidth=this.canvas.width,t.config.canvasHeight=this.canvas.height)}getPoolStats(){return this.poolManager.getAllStats()}logPoolStats(){const t=this.getPoolStats();Object.entries(t).forEach((([t,e])=>{}))}destroy(){this.stop(),this.inputSystem.destroy(),this.audioSystem.destroy(),this.unregisterClick&&this.unregisterClick(),this.particles.forEach((t=>{"celebration"===t.type?this.poolManager.release("celebrationParticle",t):this.poolManager.release("particle",t)})),this.ingredients.forEach((t=>{this.poolManager.release("ingredient",t)})),this.ingredients=[],this.orders=[],this.particles=[],this.powerUps=[],this.poolManager.clearAll(),this.performanceUI.destroy()}}"undefined"!=typeof module&&module.exports&&(module.exports=I);addEventListener("fetch",(t=>{t.respondWith(async function(t){const e=new URL(t.url);if("/"===e.pathname||"/index.html"===e.pathname){const t='<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">\n    <title>Burger Drop! - Restaurant Game</title>\n    <link rel="icon" href="data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><text y=\'.9em\' font-size=\'90\'>üçî</text></svg>">\n    <link rel="preconnect" href="https://fonts.googleapis.com">\n    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>\n    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">\n    <style>\n        {{CSS_CONTENT}}\n    </style>\n</head>\n<body>\n    <div class="top-bar">\n        <div class="logo">\n            <span style="font-size: 36px;">üçî</span>\n            <span>Burger Drop!</span>\n        </div>\n        <div class="score-display" id="scoreDisplay">Score: 0</div>\n        <button class="audio-toggle" id="audioToggle" aria-label="Toggle Audio">üîä</button>\n    </div>\n\n    <div class="performance-overlay" id="performanceOverlay"></div>\n\n    <div class="game-container">\n        <canvas id="gameCanvas"></canvas>\n    </div>\n\n    <div class="game-over-overlay" id="gameOverOverlay">\n        <div class="game-over-content">\n            <h1 class="game-over-title">Game Over! üçî</h1>\n            <div class="final-score">Final Score: <span id="finalScore">0</span></div>\n            <div class="high-score">High Score: <span id="highScore">0</span></div>\n            <button class="play-again-btn" id="playAgainBtn">Play Again!</button>\n        </div>\n    </div>\n\n    <script type="module">\n        import { Game } from \'./worker.js\';\n        \n        // Initialize and start the game\n        const game = new Game();\n        \n        // Wait for DOM to be ready\n        if (document.readyState === \'loading\') {\n            document.addEventListener(\'DOMContentLoaded\', () => game.initialize());\n        } else {\n            game.initialize();\n        }\n    <\/script>\n</body>\n</html>'.replace("{{CSS_CONTENT}}","/* BurgerDrop Game Styles */\n\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n    user-select: none;\n    -webkit-user-select: none;\n    -webkit-touch-callout: none;\n}\n\nbody {\n    font-family: 'Nunito', 'Arial', sans-serif;\n    background: \n        radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),\n        radial-gradient(circle at 80% 20%, rgba(255, 165, 0, 0.2) 0%, transparent 50%),\n        conic-gradient(from 45deg at 50% 50%, #87CEEB, #98D8C8, #87CEEB, #98D8C8);\n    overflow: hidden;\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    animation: subtleShift 20s ease-in-out infinite;\n}\n\n#gameCanvas {\n    background: \n        radial-gradient(ellipse at top, rgba(255, 255, 255, 0.2) 0%, transparent 70%),\n        linear-gradient(135deg, #FFE4B5 0%, #FFDEAD 50%, #DEB887 100%);\n    display: block;\n    margin: 0 auto;\n    border: 3px solid #8B4513;\n    box-shadow: \n        0 0 20px rgba(139, 69, 19, 0.5),\n        inset 0 0 20px rgba(255, 255, 255, 0.1);\n    border-radius: 20px;\n    transition: transform 0.3s ease;\n}\n\n.game-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.top-bar {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    background: rgba(255, 255, 255, 0.95);\n    padding: 15px 20px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    z-index: 1000;\n    backdrop-filter: blur(10px);\n    border-bottom: 3px solid #8B4513;\n}\n\n.logo {\n    font-family: 'Fredoka One', cursive;\n    font-size: 28px;\n    color: #D2691E;\n    text-shadow: 2px 2px 4px rgba(139, 69, 19, 0.3);\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.score-display {\n    font-family: 'Fredoka One', cursive;\n    font-size: 24px;\n    color: #FF6347;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.audio-toggle {\n    background: #FFD700;\n    border: 3px solid #FFA500;\n    border-radius: 50%;\n    width: 50px;\n    height: 50px;\n    font-size: 24px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n}\n\n.audio-toggle:hover {\n    transform: scale(1.1);\n    background: #FFA500;\n}\n\n.audio-toggle:active {\n    transform: scale(0.95);\n}\n\n.game-over-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.85);\n    display: none;\n    justify-content: center;\n    align-items: center;\n    z-index: 2000;\n    backdrop-filter: blur(5px);\n}\n\n.game-over-content {\n    background: linear-gradient(135deg, #FFEAA7 0%, #FEF9E7 100%);\n    padding: 40px;\n    border-radius: 25px;\n    text-align: center;\n    box-shadow: \n        0 10px 40px rgba(0, 0, 0, 0.3),\n        inset 0 0 30px rgba(255, 255, 255, 0.5);\n    border: 5px solid #D2691E;\n    max-width: 90%;\n    animation: popIn 0.5s ease-out;\n}\n\n@keyframes popIn {\n    from {\n        transform: scale(0.8);\n        opacity: 0;\n    }\n    to {\n        transform: scale(1);\n        opacity: 1;\n    }\n}\n\n.game-over-title {\n    font-family: 'Fredoka One', cursive;\n    font-size: 48px;\n    color: #D2691E;\n    margin-bottom: 20px;\n    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);\n}\n\n.final-score {\n    font-size: 36px;\n    color: #FF6347;\n    margin: 20px 0;\n    font-weight: 800;\n}\n\n.high-score {\n    font-size: 24px;\n    color: #FFA500;\n    margin: 10px 0;\n    font-weight: 700;\n}\n\n.play-again-btn {\n    background: linear-gradient(135deg, #FF6347 0%, #FF4500 100%);\n    color: white;\n    border: none;\n    padding: 15px 40px;\n    font-size: 24px;\n    font-family: 'Fredoka One', cursive;\n    border-radius: 50px;\n    cursor: pointer;\n    margin-top: 20px;\n    box-shadow: \n        0 4px 15px rgba(255, 99, 71, 0.4),\n        inset 0 -3px 0 rgba(139, 0, 0, 0.3);\n    transition: all 0.3s ease;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n}\n\n.play-again-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: \n        0 6px 20px rgba(255, 99, 71, 0.5),\n        inset 0 -3px 0 rgba(139, 0, 0, 0.3);\n}\n\n.play-again-btn:active {\n    transform: translateY(0);\n    box-shadow: \n        0 2px 10px rgba(255, 99, 71, 0.4),\n        inset 0 -1px 0 rgba(139, 0, 0, 0.3);\n}\n\n@keyframes subtleShift {\n    0%, 100% {\n        background-position: 0% 50%;\n    }\n    50% {\n        background-position: 100% 50%;\n    }\n}\n\n@media (max-width: 768px) {\n    .game-container {\n        padding: 10px;\n        padding-top: 80px;\n    }\n    \n    .logo {\n        font-size: 20px;\n    }\n    \n    .score-display {\n        font-size: 18px;\n    }\n    \n    .audio-toggle {\n        width: 40px;\n        height: 40px;\n        font-size: 20px;\n    }\n    \n    .game-over-title {\n        font-size: 36px;\n    }\n    \n    .final-score {\n        font-size: 28px;\n    }\n    \n    .play-again-btn {\n        font-size: 20px;\n        padding: 12px 30px;\n    }\n}\n\n/* Performance overlay styles */\n.performance-overlay {\n    position: fixed;\n    top: 100px;\n    right: 20px;\n    background: rgba(0, 0, 0, 0.8);\n    color: #0f0;\n    font-family: monospace;\n    font-size: 12px;\n    padding: 10px;\n    border-radius: 5px;\n    display: none;\n    z-index: 3000;\n    min-width: 200px;\n}\n\n.performance-overlay.visible {\n    display: block;\n}\n\n.performance-overlay div {\n    margin: 5px 0;\n}\n\n.performance-overlay .label {\n    display: inline-block;\n    width: 80px;\n    color: #888;\n}\n\n.performance-overlay .value {\n    color: #0f0;\n}\n\n.performance-overlay .warning {\n    color: #ff0;\n}\n\n.performance-overlay .critical {\n    color: #f00;\n}");return new Response(t,{headers:{"content-type":"text/html;charset=UTF-8","Cache-Control":"public, max-age=3600"}})}return new Response("Not Found",{status:404})}(t.request))}));export{I as Game};
